<!DOCTYPE html>
<html>
    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>DNA comparison tool</title>

        <style>
            td{background-color: #6EFF7F}
            th{background-color: lightgreen}
            .diff{background-color: red}
            .hide{display:none}
            
        </style>

    </head>
    <body>
        
        Number of strand to compare
        <select id="number">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
        </select>
        
        <br/><br/>
        
        <div id="inputs">
            <label>DNA Sequence 1:</label><br />
            <input type="text" id="seq1" class="inputField" name="seq1" value="ACACACTA" /><br/><br/>
            <label>DNA Sequence 2:</label><br />
            <input type="text" id="seq2" class="inputField" name="seq2" value="AGCACACA" /><br/><br/>
        </div>
        <input id="run" type="button" value="Run" /><br/><br/>

        <table id="outputs">
            <tr id="row1"></tr>
            <tr id="row2"></tr>
        </table>

        <script src="js/libs/jquery/jquery.min.js" type="text/javascript"></script>

        <script>
            $(document).ready(function () {
                
                $('#number').on('change', function(){
                    $('#inputs').html('');
                    $('#outputs').html('');
                    var num = $('#number :selected').val();
                    

                    for(i=1; i<=num; i++){
                        $('#inputs').append('<label>DNA Sequence '+i+'</label><br/><input type="text" id="seq'+i+'" class="inputField" name="seq'+i+'"/><br/><br/>');
                        $('#outputs').append('<tr id="row'+i+'"></tr>');
                    }
                });
                
                $( '#run' ).bind( 'click', function() {
                    
                    
                    var num = $('#number :selected').val();
                    var seq = [];
                    var strLen = 0;
                    
                    for(i=1; i<=num; i++){
                        seq[i] = document.getElementById('seq'+i).value.replace(/\s+|\n+/g, '').toUpperCase();
                        if(seq[i].length > strLen){strLen = seq[i].length;}
                        $('#row'+i).html('<td id="std'+i+'">Strand '+i+'</td><td id="sim'+i+'"></td>');
                    }
                    for(i=2; i<=num; i++){
                        for (j = 0; j < strLen; j++) {

                            if (seq[1].charAt(j) === seq[i].charAt(j)) {
                                if(i === 2){$('#row1').append('<th>' + seq[1].charAt(j) + '</th>');};
                                $('#row'+i).append('<td>' + seq[i].charAt(j) + '</td>');
                            } else
                            if (seq[1].charAt(j) !== seq[i].charAt(j)) {
                                if(i === 2){$('#row1').append('<th>' + seq[1].charAt(j) + '</th>');};
                                $('#row'+i).append('<td class="diff">' + seq[i].charAt(j) + '</td>');
                            }
                        }
                        var similr = similar(seq[1], seq[i]);
                        $('#sim'+i).html(parseFloat(similr).toFixed(2)+'% <button class="lcs" value="'+i+'">LCS</button>');
                    }
                    
                    $('.lcs').on('click', function(){
                        var sq = this.value;
                        var lcs = LCS(seq[1], seq[sq]);
                        alert(lcs);
                    });
 
                } );
                
                

            });
            
            function similar(a,b) {
                var lengthA = a.length;
                var lengthB = b.length;
                var equivalency = 0;
                var minLength = (lengthA > lengthB) ? lengthB : lengthA;    
                var maxLength = (lengthA < lengthB) ? lengthB : lengthA;    
                for(var i = 0; i < minLength; i++) {
                    if(a[i] == b[i]) {
                        equivalency++;
                    }
                }
                var weight = equivalency / maxLength;
                return (weight * 100) + "%";
            }
            
            function LCS(a, b) {
                var m = a.length, n = b.length,
                    C = [], i, j;
                for (i = 0; i <= m; i++) C.push([0]);
                for (j = 0; j < n; j++) C[0].push(0);
                for (i = 0; i < m; i++)
                    for (j = 0; j < n; j++)
                        C[i+1][j+1] = a[i] === b[j] ? C[i][j]+1 : Math.max(C[i+1][j], C[i][j+1]);
                return (function bt(i, j) {
                    if (i*j === 0) { return ""; }
                    if (a[i-1] === b[j-1]) { return bt(i-1, j-1) + a[i-1]; }
                    return (C[i][j-1] > C[i-1][j]) ? bt(i, j-1) : bt(i-1, j);
                }(m, n));
            }


        </script>

    </body>
</html>
